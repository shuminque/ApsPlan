<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.depository_manage.mapper.aps.ProductionLineHistoryMapper">

    <resultMap id="HistoryResultMap" type="com.depository_manage.entity.aps.ProductionLineHistory">
        <id column="id" property="id"/>
        <result column="line_id" property="lineId"/>
        <result column="line_code" property="lineCode"/>
        <result column="line_name" property="lineName"/>
        <result column="model" property="model"/>
        <result column="event_type" property="eventType"/>
        <result column="start_time" property="startTime"/>
        <result column="end_time" property="endTime"/>
        <result column="duration_minutes" property="durationMinutes"/>
        <result column="remark" property="remark"/>
        <result column="create_time" property="createTime"/>
    </resultMap>

    <sql id="Base_Where">
        <where>
            <if test="lineId != null">
                AND h.line_id = #{lineId}
            </if>
            <if test="eventType != null">
                AND h.event_type = #{eventType}
            </if>
            <if test="startTime != null and startTime != ''">
                AND h.start_time &gt;= #{startTime}
            </if>
            <if test="endTime != null and endTime != ''">
                AND h.start_time &lt;= #{endTime}
            </if>
        </where>
    </sql>

    <select id="selectPageList" resultMap="HistoryResultMap">
        SELECT h.id,
               h.line_id,
               l.line_code,
               l.line_name,
               h.model,
               h.event_type,
               h.start_time,
               h.end_time,
               h.duration_minutes,
               h.remark,
               h.create_time
        FROM production_line_history h
                 LEFT JOIN production_line l ON l.id = h.line_id
        <include refid="Base_Where"/>
        ORDER BY h.id DESC
        LIMIT #{offset}, #{size}
    </select>

    <select id="selectPageCount" resultType="java.lang.Long">
        SELECT COUNT(1)
        FROM production_line_history h
        <include refid="Base_Where"/>
    </select>

</mapper>
